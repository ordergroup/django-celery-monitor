{% load celery_monitor_tags %}
<div id="recent-tasks-container">
  <form class="filters" hx-get="{% url 'admin:celery_monitor_recent_tasks' %}" hx-trigger="change" hx-target="#recent-tasks-container" hx-swap="innerHTML">
    <div class="filter-group">
      <label for="status">Status:</label>
      <select name="status" id="status">
        <option value="">All</option>
        <option value="SUCCESS" {% if current_status == "SUCCESS" %}selected{% endif %}>SUCCESS</option>
        <option value="FAILURE" {% if current_status == "FAILURE" %}selected{% endif %}>FAILURE</option>
        <option value="STARTED" {% if current_status == "STARTED" %}selected{% endif %}>STARTED</option>
        <option value="PENDING" {% if current_status == "PENDING" %}selected{% endif %}>PENDING</option>
        <option value="RETRY" {% if current_status == "RETRY" %}selected{% endif %}>RETRY</option>
        <option value="REVOKED" {% if current_status == "REVOKED" %}selected{% endif %}>REVOKED</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="task_name">Task:</label>
      <select name="task_name" id="task_name">
        <option value="">All</option>
        {% for name in task_names %}
          <option value="{{ name }}" {% if current_task_name == name %}selected{% endif %}>{{ name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="filter-group">
      <label for="worker">Worker:</label>
      <select name="worker" id="worker">
        <option value="">All</option>
        {% for w in workers %}
          <option value="{{ w }}" {% if current_worker == w %}selected{% endif %}>{{ w }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="filter-group">
      <button type="button" 
              hx-get="{% url 'admin:celery_monitor_recent_tasks' %}?status={{ current_status }}&task_name={{ current_task_name }}&worker={{ current_worker }}" 
              hx-target="#recent-tasks-container" 
              hx-swap="innerHTML"
              style="cursor: pointer;">
        â†» Refresh
      </button>
    </div>
  </form>

  <table class="task-table">
    <thead>
      <tr>
        <th>Task ID</th>
        <th>Task Name</th>
        <th>Status</th>
        <th>Worker</th>
        <th>Started</th>
        <th>Completed</th>
        <th>Execution Time</th>
      </tr>
    </thead>
    <tbody>
      {% for task in recent_tasks %}
      <tr>
        <td class="task-id-cell">
          <a href="{% url 'admin:celery_monitor_task_detail' task.task_id %}">{{ task.task_id|truncatechars:20 }}</a>
        </td>
        <td>{{ task.task_name|default:"-" }}</td>
        <td><span class="status-badge {{ task.status }}">{{ task.status }}</span></td>
        <td>{{ task.worker|default:"-" }}</td>
        <td>{{ task.date_started|default:"-" }}</td>
        <td>{{ task.date_done }}</td>
        <td>{{ task.execution_time|format_duration }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="7" class="empty-row">No tasks found.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>







